-- Destroy old UI if present
if game.CoreGui:FindFirstChild("GrowGardenAutoFarmGui") then
    game.CoreGui.GrowGardenAutoFarmGui:Destroy()
end

-- Variables
local autoHarvestEnabled = false
local autoSellEnabled = false
local harvestedCount = 0

local replicatedStorage = game:GetService("ReplicatedStorage")
local players = game:GetService("Players")
local player = players.LocalPlayer

-- UI Setup
local gui = Instance.new("ScreenGui")
gui.Name = "GrowGardenAutoFarmGui"
gui.ResetOnSpawn = false
gui.Parent = game.CoreGui

local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 250, 0, 150)
frame.Position = UDim2.new(0, 20, 0, 200)
frame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
frame.BorderSizePixel = 0
frame.Parent = gui

local uicorner = Instance.new("UICorner")
uicorner.CornerRadius = UDim.new(0, 8)
uicorner.Parent = frame

local harvestButton = Instance.new("TextButton")
harvestButton.Size = UDim2.new(0, 220, 0, 40)
harvestButton.Position = UDim2.new(0, 15, 0, 10)
harvestButton.Text = "Auto Harvest: OFF"
harvestButton.TextColor3 = Color3.new(1, 1, 1)
harvestButton.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
harvestButton.Parent = frame

local sellButton = Instance.new("TextButton")
sellButton.Size = UDim2.new(0, 220, 0, 40)
sellButton.Position = UDim2.new(0, 15, 0, 60)
sellButton.Text = "Auto Sell: OFF"
sellButton.TextColor3 = Color3.new(1, 1, 1)
sellButton.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
sellButton.Parent = frame

local statusLabel = Instance.new("TextLabel")
statusLabel.Size = UDim2.new(0, 220, 0, 30)
statusLabel.Position = UDim2.new(0, 15, 0, 110)
statusLabel.Text = "Harvested & Sold: 0"
statusLabel.TextColor3 = Color3.new(1, 1, 1)
statusLabel.BackgroundTransparency = 1
statusLabel.TextScaled = true
statusLabel.Parent = frame

-- Button logic
harvestButton.MouseButton1Click:Connect(function()
    autoHarvestEnabled = not autoHarvestEnabled
    harvestButton.Text = "Auto Harvest: " .. (autoHarvestEnabled and "ON" or "OFF")
end)

sellButton.MouseButton1Click:Connect(function()
    autoSellEnabled = not autoSellEnabled
    sellButton.Text = "Auto Sell: " .. (autoSellEnabled and "ON" or "OFF")
end)

-- Update Status Text
local function UpdateStatus()
    statusLabel.Text = "Harvested & Sold: " .. harvestedCount
end

-- Main farm loop
task.spawn(function()
    while true do
        if autoHarvestEnabled then
            -- Go through garden plots
            for _, garden in pairs(workspace.Gardens:GetChildren()) do
                -- Check if this garden belongs to YOU
                if garden:FindFirstChild("Owner") and garden.Owner.Value == player.UserId then
                    -- Go through plots
                    for _, plot in pairs(garden.Plots:GetChildren()) do
                        local plant = plot:FindFirstChild("Plant")
                        if plant and plant:IsA("Model") then
                            local isReady = plant:GetAttribute("IsReady")
                            local plantName = plant:GetAttribute("PlantName") or "Unknown"
                            
                            if isReady == true then
                                -- Harvest plant
                                pcall(function()
                                    replicatedStorage.GameEvents.Harvest_RE:FireServer(plant)
                                    harvestedCount = harvestedCount + 1
                                    UpdateStatus()
                                    print("[+] Harvested: " .. plantName)
                                end)
                                
                                -- Optional sell
                                if autoSellEnabled then
                                    task.wait(0.5) -- short delay
                                    pcall(function()
                                        replicatedStorage.GameEvents.SellPlant_RE:FireServer(plantName)
                                        print("[+] Sold: " .. plantName)
                                    end)
                                end
                                
                                task.wait(1) -- wait before next plant
                            end
                        end
                    end
                end
            end
        end
        task.wait(1) -- Main loop delay
    end
end)
